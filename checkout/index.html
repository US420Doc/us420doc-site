<script>
  console.log('⚙️ Checkout script loaded');

  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('goToPayment');
    btn.addEventListener('click', async () => {
      // 1) Gather the four inputs
      const fn = document.getElementById('firstName').value.trim();
      const ln = document.getElementById('lastName').value.trim();
      const em = document.getElementById('email').value.trim();
      const ph = document.getElementById('phone').value.trim();

      if (!fn || !ln || !em || !ph) {
        alert('Please fill out all four fields.');
        return;
      }

      // 2) POST to your Netlify Function
      let resp;
      try {
        resp = await fetch('/.netlify/functions/create-checkout', {
          method:  'POST',
          headers: { 'Content-Type': 'application/json' },
          body:    JSON.stringify({ firstName: fn, lastName: ln, email: em, phone: ph })
        });
      } catch (err) {
        console.error('🛑 Failed to call function:', err);
        return alert('There was a network error. Please try again.');
      }

      // 3) Handle errors from your function
      if (!resp.ok) {
        const text = await resp.text();
        console.error('🛑 Function error:', resp.status, text);
        return alert('Sorry, something went wrong on our end.');
      }

      // 4) Parse out the checkout URL and redirect
      const { url } = await resp.json();
      if (!url) {
        console.error('🛑 No URL returned from function', await resp.text());
        return alert('Unexpected error: no checkout URL returned.');
      }

      window.location.href = url;
    });
  });
</script>
